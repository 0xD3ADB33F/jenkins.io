<!DOCTYPE html>
<html>
<head>
<title>
Getting started: Building Android apps with Hudson
</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<meta content='Jenkins is an open source automation server' name='description'>
<link href='/sites/default/files/jenkins_favicon.ico' rel='shortcut icon' type='image/x-icon'>
<!-- starting partial scriptlinks.html.haml -->
<link href='/assets/bower/bootstrap/css/bootstrap.min.css' media='screen' rel='stylesheet'>
<link href='/assets/bower/ekko-lightbox/ekko-lightbox.min.css' media='screen' rel='stylesheet'>
<link href='/assets/bower/tether/css/tether.min.css' media='screen' rel='stylesheet'>
<link href='/css/font-icons.css' media='screen' rel='stylesheet'>
<link href='/css/jenkins.css' media='screen' rel='stylesheet'>
<script src='/assets/bower/jquery/jquery.min.js'></script>
<script src='/assets/bower/tether/js/tether.min.js'></script>
<script src='/assets/bower/bootstrap/js/bootstrap.min.js'></script>
<script src='/assets/bower/ekko-lightbox/ekko-lightbox.min.js'></script>

<!-- ending partial scriptlinks.html.haml -->
</head>
<body>
<!-- starting partial toptoolbar.html.haml -->
<script>
  $(function () {
    $(document).delegate('*[data-toggle="lightbox"]', 'click', function(event) {
      event.preventDefault();
      $(this).ekkoLightbox();
    });
  })
</script>
<div id='ji-hover-layer'></div>
<nav class='navbar navbar-dark bg-inverse' id='ji-toolbar'>
<a class='fixed navbar-brand' href='/' id='home-logo'>
Jenkins
</a>
<ul class='nav navbar-nav'>
<li class='nav-item fixed'>
<div class='btn-group' id='download-menu'>
<a aria-expanded='false' aria-haspopup='true' class='btn btn-primary dropdown-toggle' data-toggle='dropdown'>
Downloads
</a>
<!-- starting partial downloadlist.html.haml -->
<div class='dropdown-menu'>
<div class='row'>
<div class='col-md-6 text-xs-center'>
<h3>
LTS Release
</h3>
<p>
LTS (Long-Term Support) releases are chosen every 12 weeks from the
stream of regular releases as the stable release for that time period.
</p>
<p>
<div class='btn-group'>
<a class='btn btn-primary' href='http://mirrors.jenkins-ci.org/war-stable/latest/jenkins.war'>
<i class='icon-box-add'>
1.642.1
.war
</i>
</a>
<button aria-expanded='false' aria-haspopup='true' class='btn btn-primary dropdown-toggle' data-toggle='dropdown' data-trigger='hover'></button>
<div class='dropdown-menu'>
<a class='dropdown-item' href='https://registry.hub.docker.com/u/jenkinsci/jenkins/'>
<span class='icon'></span>
<span class='title'>
Docker
</span>
</a>
<a class='dropdown-item' href='http://www.freshports.org/devel/jenkins-lts'>
<span class='icon'></span>
<span class='title'>
FreeBSD
</span>
</a>
<a class='dropdown-item' href='https://packages.gentoo.org/packages/dev-util/jenkins-bin'>
<span class='icon'></span>
<span class='title'>
Gentoo
</span>
</a>
<a class='dropdown-item' href='/content/thank-you-downloading-os-x-installer#stable'>
<span class='icon'></span>
<span class='title'>
Mac OS X
</span>
</a>
<a class='dropdown-item' href='http://openports.se/devel/jenkins/stable'>
<span class='icon'></span>
<span class='title'>
OpenBSD
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/opensuse-stable/'>
<span class='icon'></span>
<span class='title'>
openSUSE
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/redhat-stable/'>
<span class='icon'></span>
<span class='title'>
Red Hat/Fedora/CentOS
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/debian-stable/'>
<span class='icon'></span>
<span class='title'>
Ubuntu/Debian
</span>
</a>
<a class='dropdown-item' href='/content/thank-you-downloading-windows-installer#stable'>
<span class='icon'></span>
<span class='title'>
Windows
</span>
</a>
</div>
</div>
</p>
<p class='details'>
<a class='item' href='/changelog-stable'>Changelog</a>
|
<a class='item' href='http://mirrors.jenkins-ci.org/war-stable/'>Past Releases</a>
</p>
</div>
<div class='col-md-6 text-xs-center'>
<h3>
Weekly Release
</h3>
<p>
A new release is produced weekly to deliver bug fixes and features to
users and plugin developers.
</p>
<p>
<div class='btn-group'>
<a class='btn btn-primary' href='http://mirrors.jenkins-ci.org/war/latest/jenkins.war'>
<i class='icon-box-add'>
1.647
.war
</i>
</a>
<button aria-expanded='false' aria-haspopup='true' class='btn btn-primary dropdown-toggle' data-toggle='dropdown' data-trigger='hover'></button>
<div class='dropdown-menu'>
<a class='dropdown-item' href='https://registry.hub.docker.com/u/jenkinsci/jenkins/'>
<span class='icon'></span>
<span class='title'>
Docker
</span>
</a>
<a class='dropdown-item' href='http://www.freshports.org/devel/jenkins'>
<span class='icon'></span>
<span class='title'>
FreeBSD
</span>
</a>
<a class='dropdown-item' href='https://packages.gentoo.org/packages/dev-util/jenkins-bin'>
<span class='icon'></span>
<span class='title'>
Gentoo
</span>
</a>
<a class='dropdown-item' href='/content/thank-you-downloading-os-x-installer'>
<span class='icon'></span>
<span class='title'>
Mac OS X
</span>
</a>
<a class='dropdown-item' href='http://openports.se/devel/jenkins/devel'>
<span class='icon'></span>
<span class='title'>
OpenBSD
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/opensuse/'>
<span class='icon'></span>
<span class='title'>
openSUSE
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/redhat/'>
<span class='icon'></span>
<span class='title'>
Red Hat/Fedora/CentOS
</span>
</a>
<a class='dropdown-item' href='http://pkg.jenkins-ci.org/debian/'>
<span class='icon'></span>
<span class='title'>
Ubuntu/Debian
</span>
</a>
<a class='dropdown-item' href='/content/thank-you-downloading-windows-installer'>
<span class='icon'></span>
<span class='title'>
Windows
</span>
</a>
</div>
</div>
</p>
<p class='details'>
<a class='item' href='/changelog'>Changelog</a>
|
<a class='item' href='http://mirrors.jenkins-ci.org/war/'>Past Releases</a>
</p>
</div>
</div>
</div>

<!-- ending partial downloadlist.html.haml -->
</div>
</li>
<li class='nav-item'>
<a class='nav-link' href='/events'>
Events
</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='https://wiki.jenkins-ci.org/'>
Wiki
</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='https://issues.jenkins-ci.org/'>
Issues
</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='/doc'>
Documentation
</a>
</li>
<li class='nav-item dropdown'>
<a aria-expanded='false' aria-haspopup='true' class='nav-link dropdown-toggle' data-toggle='dropdown' href='#' role='button'>
Use-cases
</a>
<div class='dropdown-menu'>
<a class='dropdown-item feature' href='/solutions/android/' title='Jenkins and Android'>
Android
</a>
<a class='dropdown-item feature' href='/solutions/c/' title='Jenkins and C/C++'>
C/C++
</a>
<a class='dropdown-item feature' href='/solutions/pipeline/' title='Pipeline as Code with Jenkins'>
Continuous Delivery
</a>
<a class='dropdown-item feature' href='/solutions/docker/' title='Jenkins and Docker'>
Docker
</a>
<a class='dropdown-item feature' href='/solutions/embedded/' title='Jenkins in Embedded World'>
Embedded
</a>
<a class='dropdown-item feature' href='/solutions/github/' title='Jenkins with GitHub'>
GitHub
</a>
<a class='dropdown-item feature' href='/solutions/java/' title='Jenkins and Java'>
Java
</a>
<a class='dropdown-item feature' href='/solutions/python/' title='Jenkins and Python'>
Python
</a>
<a class='dropdown-item feature' href='/solutions/ruby/' title='Jenkins and Ruby'>
Ruby
</a>
</div>
</li>
<li class='nav-item'>
<a class='nav-link' href='/press'>
Press
</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='/conduct'>
Conduct
</a>
</li>
</ul>
<form action='/app/' class='search form-inline navbar-form pull-right text-xs-right'>
<div class='form-group'>
<div class='input-group'>
<input class='form-control' name='q' placeholder='search' type='text'>
<button class='input-group-addon btn btn-default' type='submit'>
<i class='icon-search'></i>
</button>
</div>
</div>
</form>
</nav>
<div id='ji-toolbar-offset'></div>
<div id='ji-top-peg'>
<a href='https://github.com/jenkinsci' id='ji-fork-tag'>
<img alt='Fork us on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' style='position: absolute; top: 0; right: 0; border: 0;'>
</a>
</div>

<!-- ending partial toptoolbar.html.haml -->
<div class='container blog-post no-margin'>
<div class='row body'>
<div class='col-md-1'></div>
<div class='col-md-7 main-content with-sidebar' id='content'>
<div id='content-top'>
<h1>
<a href='/blog/2010/02/17/getting-started-building-android-apps-with-hudson/' title='Getting started: Building Android apps with Hudson'>
Getting started: Building Android apps with Hudson
</a>
</h1>
<!-- starting partial tweetbutton.html.haml -->
<div style='float: right; clear: all;'>
<a class='twitter-share-button' data-lang='en' href='https://twitter.com/share'>
Tweet
</a>
</div>

<!-- ending partial tweetbutton.html.haml -->
<span class='submitted'>
Published on
2010-02-17T00:00:00+00:00
by
<a href="https://github.com/rtyler">R. Tyler Croy</a>
</span>
</div>
<p><img src="/sites/default/files/hvisser_android_project.png" align="right" />In this post I'll show a very basic tips on how to compile an Android project using Hudson. Specifically how  I use Hudson to create release versions of my apps.</p>

<h2 id="debug-vs-release">Debug vs Release</h2>
<p>I'm assuming that you are using <a id="aptureLink_s44SkgAX9H" href="http://en.wikipedia.org/wiki/Eclipse%20%28software%29">Eclipse</a> with the <a id="aptureLink_MtfIHO5Nxu" href="http://developer.android.com/guide/developing/tools/adt.html">ADT plugin</a>. During development you can test your app on the emulator or a device and resources like R.java and aidl files are compiled for you automatically by the plugin. When it's time to release your app, you'll need to go through some steps:</p>

<ul>
  <li>You must sign your app using a certificate</li>
  <li>You must update your AndroidManifest.xml to remove the android:debuggable attribute</li>
  <li>Replace your Google Maps API debug key with the one belonging to your release certificate (if you are using a MapView)</li>
  <li>Generate an apk package for the release and test it on a device or emulator</li>
</ul>

<p>It would be nice to automate a few of these steps, and this is where Hudson comes in.</p>

<h2 id="automated-builds-ant">Automated builds: Ant</h2>
<p>For automated builds the Android SDK uses <a id="aptureLink_THdW39aNW6" href="http://en.wikipedia.org/wiki/Apache%20Ant">Apache Ant</a>, which Hudson has great support for. To generate a template build.xml you can use the android tool from the SDK using the following command:
&lt;code linenumbers=off&gt;
android create project -n template -t android-7 -p template -k dummy.pkg -a Dummy
&lt;/code&gt;
The target is specified as "android-7" meaning that we are building for Android 2.1. For apps that use MapView we would use "Google Inc.:Google APIs:7". It is a good idea to always <a href="http://d.android.com/guide/practices/screens_support.html#strategies">target the latest SDK</a>. From this template project we'll grab the <em>build.properties</em> and the <em>build.xml</em> and copy those to the Android project that we want to build. Edit <em>build.xml</em> and set the project name to your Android project name.</p>

<p>The <em>local.properties</em> file contains the path to the SDK root and shouldn't be checked in to version control. For our use we'll set the properties that are in that file on the Hudson job configuration page.</p>

<h2 id="running-the-build-in-hudson">Running the build in Hudson</h2>
<p>This part is easy: create a new freestyle job and let it be build with ant. The targets that we want to execute are <code>clean release</code>. Release will compile, package and sign your apk. Now to get this working right, some custom properties should be set (use the Advanced button).</p>

<center><img src="/sites/default/files/hvisser_android_properties.png" /></center>

<hr />
<p><code>
sdk.dir=/Users/hugo/Code/android-sdk-mac
target=Google Inc.:Google APIs:7
key.store=certs/rd-release.keystore
key.alias=rainydays
key.store.password=thisisnotmypassword
key.alias.password=thisisnotmypassword
</code>
The <em>sdk.dir</em> should point to the Android SDK root on your Hudson node. In my case I'm running Hudson locally on my machine.  The <em>target</em> property refers to the SDK we want to use as mentioned earlier.  The <em>key.** properties are related to signing of the apk. My <a href="http://d.android.com/guide/publishing/app-signing.html#strategies">strategy</a> is to have a separate key store and private key for each application that I develop. <img src="/sites/default/files/hvisser_android_archive.png" align="right" /> I also check that keystore in to SVN. I also archive the **-release.apk</em> artifact so that I can download the latest release apk directly from Hudson.  After completing these steps, you should be able to build your Android app with Hudson.</p>

<p><br clear="all" />
## Updating the AndroidManifest for release
…But we're not done yet :) Remember what I said about updating the AndroidManifest.xml? For that we need to edit the build.xml, which by default contains nothing more then a <code><setup></setup></code> tag to pull in the Android SDK ant target definitions. For my Rainy Days application, I adjusted build.xml like this:
<code>
   ...</code></p>
<setup />

<property environment="env" />

<target name="preprocess" if="env.BUILD_TAG">
      <echo>Removing debug attribute from AndroidManifest.xml</echo>
      <replaceregexp file="AndroidManifest.xml" match="android:debuggable=&quot;.*?&quot;" replace="" />
      <echo>Setting release maps key</echo>
      <replaceregexp file="res/layout/maplayout.xml" match="android:apiKey=&quot;.*?&quot;" replace="android:apiKey=&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;" />			
   </target>

<p><!-- this target is only hooking release processing of the manifest --></p>
<target name="-package-resources" depends="preprocess, android_rules.-package-resources">
   </target>
<p>&lt;/code&gt;</p>

<p>What the above snippet does is removing the <em>android:debuggable</em> attribute from the <em>AndroidManifest.xml</em> and replacing the maps API key in <em>res/layout/maplayout.xml</em> with the correct key for release. The <code>-package-resources</code> target is pulled in from the Android <em>android_rules.xml</em> file.</p>

<p>Now when Hudson builds my app I get a ready to release apk that I can install on my device or emulator, which is pretty nice.</p>

<p>There is are some issues with this approach however. As you might have noticed:</p>

<ul>
  <li>Replacements are done in the workspace, we are not really building <strong>exactly</strong> what's in svn</li>
  <li>Each new build should start out fresh for that reason, for example by using the svn revert option.</li>
</ul>

<p>Additionally I can not yet tag the release version with the updated files, because the <a href="http://wiki.hudson-ci.org/display/HUDSON/Subversion+Tagging+Plugin">subversion tagging plugin</a> doesn't support this by design. This could be worked around by adding svn statements in the build.xml however.  For now I don't really mind as I make minor changes to the resource files, but I'll be looking at improving this situation.</p>

<h2 id="things-to-add-unit-testing-coverage">Things to add: unit testing, coverage…</h2>
<p>One thing that I'd really like to add is unit testing. This is a little bit more complicated though, since unit tests require a running emulator and a running emulator requires a gui. The Hudson <a href="http://wiki.hudson-ci.org/display/HUDSON/Xvnc+Plugin">Xvnc</a> plugin could be very helpful here.</p>

<p>The Android build scripts for test projects already include <a href="http://emma.sourceforge.net/">EMMA</a> output, it shouldn't be to hard to use the Hudson <a href="http://wiki.hudson-ci.org/display/HUDSON/Emma+Plugin">plugin</a> for that.</p>

<p>When Hudson is running on a local machine, the <a href="http://wiki.hudson-ci.org/display/HUDSON/Batch+Task+Plugin">Batch task</a> plugin can automate installing the apk on a device to automate things further.</p>

<h2 id="summary">Summary</h2>
<p>Building Android applications with Hudson is not that hard, since the builds are based on Ant. By hooking in to the standard Android build targets it's easy to update files like <em>AndroidManifest.xml</em> which in turn makes sure the release process is controlled and predictable.<br />
Android unit tests depend on the emulator which is a little bit more challenging to set up, but Hudson already has some plugins available to make this easier.</p>

<hr />
<p><strong>Editor's Note:</strong> Hugo Visser is the developer of <a href="http://code.neenbedankt.com/my-first-published-android-app-rainy-days">Rainy Days</a> and <a href="http://code.neenbedankt.com/monitor-your-app-engine-application-from-your">Engine Watch</a> for Android. You can
follow him <a href="http://twitter.com/botteaap">on Twitter</a> and <a href="http://code.neenbedankt.com">on his blog</a>.
<!--break--></p>

</div>
<div class='col-md-4 events' id='sidebar'>
<!-- starting partial sidebar.html.haml -->
<div class='content'>
<div class='item-list'>
<ul class='ji-date-list ji-item-list'>
<li class='post event'>
<a class='body' href='#'>
<div class='header time'>
<div class='date-time'>
<div class='date'>
<div class='month'>
Jan
</div>
<div class='day'>
10
</div>
<div class='dow'>
Tu
</div>
</div>
<div class='time'>
12:00pm
</div>
</div>
<h5 class='title'>
This is an event
</h5>
</div>
<p class='teaser'>
Descriptions of the events are a good thing to have, so this is an example of one of moderate size.
<div class='more'></div>
</p>
</a>
<div class='attrs'></div>
</li>
<li class='post event'>
<a class='body' href='#'>
<div class='header time'>
<div class='date-time'>
<div class='date'>
<div class='month'>
Jan
</div>
<div class='day'>
10
</div>
<div class='dow'>
We
</div>
</div>
<div class='time'>
12:00pm
</div>
</div>
<h5 class='title'>
This is an event
</h5>
</div>
<p class='teaser'>
Descriptions of the events are a good thing to have, so this is an example of one of moderate size.
<div class='more'></div>
</p>
</a>
<div class='attrs'></div>
</li>
<li class='post event'>
<a class='body' href='#'>
<div class='header time'>
<div class='date-time'>
<div class='date'>
<div class='month'>
Jan
</div>
<div class='day'>
10
</div>
<div class='dow'>
Th
</div>
</div>
<div class='time'>
12:00pm
</div>
</div>
<h5 class='title'>
This is an event
</h5>
</div>
<p class='teaser'>
Descriptions of the events are a good thing to have, so this is an example of one of moderate size.
<div class='more'></div>
</p>
</a>
<div class='attrs'></div>
</li>
<li class='post event'>
<a class='body' href='#'>
<div class='header time'>
<div class='date-time'>
<div class='date'>
<div class='month'>
Jan
</div>
<div class='day'>
10
</div>
<div class='dow'>
Fr
</div>
</div>
<div class='time'>
12:00pm
</div>
</div>
<h5 class='title'>
This is an event
</h5>
</div>
<p class='teaser'>
Descriptions of the events are a good thing to have, so this is an example of one of moderate size.
<div class='more'></div>
</p>
</a>
<div class='attrs'></div>
</li>
<li class='post event'>
<a class='body' href='#'>
<div class='header time'>
<div class='date-time'>
<div class='date'>
<div class='month'>
Jan
</div>
<div class='day'>
10
</div>
<div class='dow'>
We
</div>
</div>
<div class='time'>
12:00pm
</div>
</div>
<h5 class='title'>
This is an event
</h5>
</div>
<p class='teaser'>
Descriptions of the events are a good thing to have, so this is an example of one of moderate size.
<div class='more'></div>
</p>
</a>
<div class='attrs'></div>
</li>
</ul>
</div>
</div>

<!-- ending partial sidebar.html.haml -->
</div>
</div>
</div>


<!-- starting partial footermenu.html.haml -->
<div class='brick-tops footer'></div>
<footer id='footer'>
<div class='license-box col-md-5'>
<p>
<div id='creativecommons'>
<a href='https://creativecommons.org/licenses/by-sa/4.0/'>
<img src='https://licensebuttons.net/l/by-sa/4.0/88x31.png'>
</a>
</div>
Some about Jenkins text and links to terms and license.
<div class='box'>
<a href='https://github.com/jenkins-infra/jenkins.io/edit/master/content//_partials/footermenu.html.haml' title='Edit /_partials/footermenu.html.haml on GitHub'>
Improove this page
</a>
|
<a href='https://github.com/jenkins-infra/jenkins.io/commits/master/content//_partials/footermenu.html.haml' title='View /_partials/footermenu.html.haml history on GitHub'>
Page history
</a>
</div>
</p>
</div>
<div class='links col-md-7'>
<ul class='major-areas'>
<li class='area solo'>
<h5>Resources</h5>
<ul class='resources'>
<li>Plugins</li>
<li>Blog articles</li>
<li>Events</li>
<li>Documentation</li>
<li>Blog articles</li>
</ul>
</li>
<li class='area multi'>
<h5>Solutions</h5>
<ul>
<li>Jenkins features</li>
<li>Docker</li>
<li>Pipelines</li>
<li>Security</li>
<li>Scalability</li>
</ul>
</li>
<li class='area multi'>
<h5>Project</h5>
<ul class='project'>
<li>Governance</li>
<li>GitHub Repo</li>
<li>Issue tracker</li>
<li>Jenkins builds</li>
</ul>
</li>
<li class='area multi'>
<h5>Community</h5>
<ul class='community'>
<li>Developer newsgroup</li>
<li>User newsgroup</li>
<li>StackOverflow</li>
<li>IRC chat</li>
<li>Twitter</li>
<li>Reddit</li>
</ul>
</li>
</ul>
</div>
</footer>

<!-- ending partial footermenu.html.haml -->
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){

                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),

                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)

                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-4216293-5', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

</body>
</html>
