<html>
<head>
<title>
Faster slave classloading
</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<meta content='Jenkins is an open source automation server' name='description'>
<link href='/css/style.css' media='screen' rel='stylesheet'>
</head>
<body>
<a href='https://github.com/jenkinsci'>
<img alt='Fork us on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' style='position: absolute; top: 0; right: 0; border: 0;'>
</a>
<div class='clearfloat' id='head'>
<div class='clearfloat'>
<div id='logo'>
<a href='/' title='Jenkins'>
<img src='/images/header_logo.png'>
</a>
<div id='tagline'>
An extendable open source automation server
</div>
</div>
</div>
<!-- starting partial navbar.html.haml -->
<div class='clearfloat' id='navbar'>
<div id='page-bar'>
<ul class='menu'>
<li class='leaf first'>
<a href='/node' title='Blog landing page'>
Blog
</a>
</li>
<li class='expanded'>
<a href='/' title=''>
Connect
</a>
<ul class='menu'>
<li class='leaf first'>
<a href='/content/mailing-lists' title='Browse Jenkins mailing list archives and/or subscribe to lists'>
Mailing Lists
</a>
</li>
<li class='leaf'>
<a href='/content/chat' title='Chat with the rest of the Jenkins community on IRC'>
Chat
</a>
</li>
<li class='leaf'>
<a href='http://twitter.com/jenkinsci' title='Check out @jenkinsci on Twitter'>
Twitter
</a>
</li>
<li class='leaf'>
<a href='/content/event-calendar' title='Calendar for Jenkins events'>
Event Calendar
</a>
</li>
<li class='leaf'>
<a href='https://wiki.jenkins-ci.org/display/JENKINS/Office+Hours' title='WebEx-based online meeting'>
Office Hours
</a>
</li>
<li class='leaf last'>
<a href='https://reddit.com/r/jenkinsci' title='Check out the latest links and news on jenkinsci.reddit.com!'>
reddit
</a>
</li>
</ul>
</li>
<li class='leaf'>
<a href='https://wiki.jenkins-ci.org/display/JENKINS/Issue+Tracking' title='JIRA for Jenkins'>
Bug Tracker
</a>
</li>
<li class='leaf'>
<a href='http://wiki.jenkins-ci.org/' title='Main documentation of Jenkins'>
Wiki
</a>
</li>
<li class='leaf'>
<a href='http://ci.jenkins-ci.org/' title='Jenkins and plugins built on Jenkins'>
CI
</a>
</li>
<li class='leaf'>
<a href='https://wiki.jenkins-ci.org/display/JENKINS/Donation' title=''>
Donation
</a>
</li>
<li class='leaf last'>
<a href='/content/about-jenkins-ci' title='About Jenkins CI'>
About
</a>
</li>
</ul>
</div>
</div>

<!-- ending partial navbar.html.haml -->
</div>
<div class='clearfloat' id='page'>
<div class='clearfloat' id='top'>
<div id='sidebar'>
<!-- starting partial sidebar.html.haml -->
<div class='block block-block even' id='block-block-5'>
<h3>
What is Jenkins?
</h3>
<div class='content'>
<p>
In a nutshell, Jenkins is the leading open source automation server.
Built with Java, it provides
<strong>
hundreds
</strong>
of plugins to support building, testing, deploying and automation
virtually any project
</p>
</div>
</div>
<!-- starting partial download.html.haml -->
<link href='/css/download.css' media='screen' rel='stylesheet'>
<link href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/themes/base/jquery.ui.all.css' media='screen' rel='stylesheet'>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js'></script>
<div class='block block-block even' id='block-block-15'>
<h3>
Download
</h3>
<div class='content'>
<div id='download-tabs'>
<ul class='tab-bar'>
<li>
<a href='#release'>
Release
</a>
</li>
<li>
<a href='#stable'>
Long-Term Support Release
</a>
</li>
</ul>
<div class='tab' id='release'>
<dl>
<dt>
Java Web Archive (.war)
</dt>
<dd>
<div>
<a href='http://mirrors.jenkins-ci.org/war/latest/jenkins.war'>
<strong>
Latest:
1.639
</strong>
</a>
</div>
<div class='release-block-small'>
<a href='/changelog'>
changelog
</a>
|
<a href='http://mirrors.jenkins-ci.org/war/'>
past releases
</a>
</div>
</dd>
<dt>Native packages</dt>
<dd class='release-block-platforms'>
<div>
<img src='/images/os/win_other.png'>
<a class='release-block-soft' href='http://mirrors.jenkins-ci.org/windows/latest' onclick="return download('http://jenkins-ci.org/content/thank-you-downloading-windows-installer')">Windows</a>
</img>
</div>
<div>
<img src='/images/os/ubuntu.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/debian/'>Ubuntu/Debian</a>
</img>
</div>
<div>
<img src='/images/os/redhat.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/redhat/'>Red Hat/Fedora/CentOS</a>
</img>
</div>
<div>
<img src='/images/os/os_macosx.png'>
<a class='release-block-soft' href='http://mirrors.jenkins-ci.org/osx/latest' onclick="return download('http://jenkins-ci.org/content/thank-you-downloading-os-x-installer')">Mac OS X</a>
</img>
</div>
<div>
<img src='/images/os/opensuse.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/opensuse/'>openSUSE</a>
</img>
</div>
<div>
<img src='/images/os/freebsd.png'>
<a class='release-block-soft' href='http://www.freshports.org/devel/jenkins'>FreeBSD</a>
</img>
</div>
<div>
<img src='/images/os/os_openbsd.png'>
<a class='release-block-soft' href='http://openports.se/devel/jenkins/devel'>OpenBSD</a>
</img>
</div>
<div>
<img src='/images/os/os_gentoo.png'>
<a class='release-block-soft' href='http://code.google.com/p/godin-gentoo-repository/wiki/Jenkins'>Gentoo</a>
</img>
</div>
</dd>
<dt>Docker</dt>
<dd id='release-block-platforms'>
<div>
<a class='release-block-soft' href='https://registry.hub.docker.com/u/jenkinsci/jenkins/'>
<tt>docker pull jenkinsci/jenkins</tt>
</a>
</div>
</dd>
</dl>
</div>
<div class='tab' id='stable'>
<dl>
<dt>Java Web Archive (.war)</dt>
<dd style='margin-bottom:1em'>
<div>
<a href='http://mirrors.jenkins-ci.org/war-stable/latest/jenkins.war'>
<strong>
Older but stable:
1.625.2
</strong>
</a>
</div>
<div class='release-block-small' style='text-align:right'>
<a class='release-block-soft' href='/changelog-stable'>changelog</a>
|
<a class='release-block-soft' href='http://mirrors.jenkins-ci.org/war-stable/'>past releases</a>
|
<a class='release-block-soft' href='/stable-rc'>RC</a>
</div>
<br>
<div style='text-align:right'>
<a href='https://wiki.jenkins-ci.org/display/JENKINS/LTS+Release+Line'>
<strong>What is LTS?</strong>
</a>
</div>
</dd>
<dt>Native packages</dt>
<dd class='release-block-platforms'>
<div>
<img src='/images/os/win_other.png'>
<a class='release-block-soft' href='http://mirrors.jenkins-ci.org/windows-stable/latest' onclick="return download('http://jenkins-ci.org/content/thank-you-downloading-windows-installer?releaseLine=-stable')">Windows</a>
</img>
</div>
<div>
<img src='/images/os/ubuntu.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/debian-stable/'>Ubuntu/Debian</a>
</img>
</div>
<div>
<img src='/images/os/redhat.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/redhat-stable/'>Red Hat/Fedora/CentOS</a>
</img>
</div>
<div>
<img src='/images/os/os_macosx.png'>
<a class='release-block-soft' href='http://mirrors.jenkins-ci.org/osx-stable/latest' onclick="return download('http://jenkins-ci.org/content/thank-you-downloading-os-x-installer?releaseLine=-stable')">Mac OS X</a>
</img>
</div>
<div>
<img src='/images/os/opensuse.png'>
<a class='release-block-soft' href='http://pkg.jenkins-ci.org/opensuse-stable/'>openSUSE</a>
</img>
</div>
<div>
<img src='/sites/default/files/images/freebsd.png'>
<a class='release-block-soft' href='http://www.freshports.org/devel/jenkins-lts'>FreeBSD</a>
</img>
</div>
<div>
<img src='/images/os/os_openbsd.png'>
<a class='release-block-soft' href='http://openports.se/devel/jenkins/stable'>OpenBSD</a>
</img>
</div>
<div>
<img src='/images/os/os_gentoo.png'>
<a class='release-block-soft' href='http://code.google.com/p/godin-gentoo-repository/wiki/Jenkins'>Gentoo</a>
</img>
</div>
</dd>
</dl>
<dt>Docker</dt>
<dd id='release-block-platforms'>
<div>
<a class='release-block-soft' href='https://registry.hub.docker.com/_/jenkins/'>
<tt>docker pull jenkins</tt>
</a>
</div>
</dd>
</div>
</div>
</div>
</div>
<script>
  $(function(){
    if (window.location.pathname == '/changelog-stable' || window.location.pathname == '/stable-rc') {
      $("#download-tabs").tabs({ selected: 1 });
    } else {
      $("#download-tabs").tabs();
    }
    $("#download-tabs, #download-tabs .ui-tabs-nav, #download-tabs .ui-tabs-nav > *" )
      .removeClass( "ui-corner-all ui-corner-top" );
  });
  
  function download(href) {
    window.location = href;
    return false;
  }
</script>
<style>
  .ui-widget { font-family: inherit !important; }
  .ui-widget-content { color:inherit !important; }
  .ui-widget-content .tab a { color: #D24939 !important; }
</style>

<!-- ending partial download.html.haml -->
<!-- starting partial book.html.haml -->
<div class='block block-block even' id='block-block-15'>
<div class='content'>
<center>
<a href='http://www.wakaleo.com/books/jenkins-the-definitive-guide'>
<img alt='Jenkins: The Definitive Guide' border='0' src='http://agentdero.cachefly.net/continuousblog/images/jenkins-cover-small.png' width='220'>
</a>
<br>
<a href='http://oreilly.com/catalog/0636920010326'>
<strong>
Buy the book!
</strong>
</a>
</center>
</div>
</div>

<!-- ending partial book.html.haml -->
<!-- starting partial resources.html.haml -->
<div class='block block-block odd' id='block-block-8'>
<h3>
Resources
</h3>
<div class='content'>
<big>
<p>
<a href='/calendar'>
Calendar
</a>
</p>
<p>
<a href='https://wiki.jenkins-ci.org/'>
Wiki
</a>
</p>
<p>
<a href='https://issues.jenkins-ci.org/'>
Issues
</a>
</p>
<p>
<a href='http://ci.jenkins-ci.org/'>
Jenkins-on-Jenkins
</a>
</p>
</big>
</div>
</div>

<!-- ending partial resources.html.haml -->

<!-- ending partial sidebar.html.haml -->
</div>
<div class='main-content with-sidebar' id='content'>
<div id='content-top'>
<div class='node clear-block'>
<h1>
<a href='/blog/2013/07/24/faster-slave-classloading/' title='Faster slave classloading'>
Faster slave classloading
</a>
</h1>
<span class='submitted'>
Published on
2013-07-24T00:00:00+00:00
</span>
<!-- starting partial tweetbutton.html.haml -->
<div style='float: right; clear: all;'>
<a class='twitter-share-button' data-lang='en' href='https://twitter.com/share'>
Tweet
</a>
</div>

<!-- ending partial tweetbutton.html.haml -->
<div class='content'>
<div style="float:right; margin:1em"><br/>
<a href="http://en.wikipedia.org/wiki/Chloride"><br/>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Calcium_chloride_CaCl2.jpg/320px-Calcium_chloride_CaCl2.jpg"></a><br/>
</div><br/>
<br/>
<p><br/>
Jenkins comes with <a href="https://github.com/jenkinsci/remoting">the remoting library</a> that it uses to communicate between a master and slaves. This is a pretty awesome library, I think, which served us well.<br/>
<br/>
<p><br/>
One of the things this remoting layer does it to transfer the Java byte code on demand from the master to slaves on demand. This approach helps us keep slave deployment simple, as you don't have to keep the master and all the slaves in sync, but it also made the slave start-up slower, because none of the byte code loaded to slaves are kept around. It was all forgotten once the slave gets disconnected.<br/>
<br/>
<p><br/>
When slaves are static and stays online for hours, this wasn't a problem at all. But as more and more slaves become elastic (think EC2 or CloudBees DEV@cloud), This delay is becoming more and more noticeable. A similar issue happens when the Maven project type, which uses the same remoting library to talk to the running Maven build.<br/>
<br/>
<p><br/>
Another related performance bottleneck is the round-trip latency. When your slave is far away from a master, every classloading would incur a network round-trip, and it can add up quickly. This is because Java classloading abstraction is funamentally chatty.<br/>
<br/>
<p><br/>
Jesse and I <a href="https://issues.jenkins-ci.org/browse/JENKINS-15120">started seriously thinking about this problem</a> last year, and we've <a href="https://github.com/jenkinsci/remoting/pull/10">kept a branch going</a> to address this problem.<br/>
<br/>
<p><br/>
After several trans-atlantic hacking during flights, we were finally able to release this in 1.519.<br/>
<br/>
<p><br/>
Starting this version, the remoting layer uses a local jar file cache to store jar files that were downloaded from the master. This pretty much eliminated the need to send class files over the wire.<br/>
<br/>
<p><br/>
In addition, the master will analyze class files as a slave request them and "push down" information about how related other classes should be loaded by the slave. This speculative "prefetching" saves the slave from making an expensive network round trip to the master.<br/>
<br/>
<p><br/>
In <a href="http://jenkins-ci.361315.n4.nabble.com/Efficient-class-jar-prefetching-in-remoting-td4665943.html">my benchmark using Maven builds, the prefetching cut the # of roundtrips to about half</a>.<br/>
<br/>
<p><br/>
If you do a lot of Maven builds, or if you have elastic slaves, we highly encourage you to upgrade.<br/>
<br/>
<br/>
<br/>
<br/>

</div>
</div>

<div id='content-bottom'>
</div>
</div>
<!-- starting partial footer.html.haml -->
<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>

<!-- ending partial footer.html.haml -->
<div id='github'>
<a href='https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2013/2013-07-24-faster-slave-classloading.html' title='Edit /blog/2013/2013-07-24-faster-slave-classloading.html on GitHub'>
Improve this page
</a>
</div>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){

                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),

                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)

                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-4216293-5', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

</body>
</html>
